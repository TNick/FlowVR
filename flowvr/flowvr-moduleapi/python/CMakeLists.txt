OPTION(BUILD_FLOWVR_PYTHONMODULEAPI "Build FlowVR Python Module API" TRUE)

# cflowvr.py and cflowvr_wrap.cxx were generated by 
# swig -v -python -c++  -I/home/matthijs/src/grimage/install/include/ cflowvr.swg
# add a rule for this!

IF( BUILD_FLOWVR_PYTHONMODULEAPI ) 

  FIND_PACKAGE(SWIG)
 
 MACRO_LOG_FEATURE(SWIG_FOUND  "SWIG" 
    "Simplified Wrapper and Interface Generator" 
    "http://www.swig.org/" 
    FALSE  
    "Required to Generate the Python Module API")
  

  
  # Already  searched at  higher level (flowvr/CMakeLists.txt)
  #FIND_PACKAGE(PythonLibs)
  
  IF( PYTHONLIBS_FOUND  AND SWIG_FOUND  )

    INCLUDE(${SWIG_USE_FILE})
    
    INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})
    
    INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
    
    SET(CMAKE_SWIG_FLAGS "")
    
    SET_SOURCE_FILES_PROPERTIES(cflowvr.swg PROPERTIES CPLUSPLUS ON)
    SET_SOURCE_FILES_PROPERTIES(cflowvr.swg PROPERTIES SWIG_FLAGS "-includeall")
    SWIG_ADD_MODULE(cflowvr python cflowvr.swg cflowvr_wrap.cxx)
    SWIG_LINK_LIBRARIES(cflowvr ${PYTHON_LIBRARIES} flowvr-base flowvr-mod)
    
    
    #execute_process(COMMAND swig -v -python -c++ -I${flowvr_base_SOURCE_DIR}/include cflowvr.swg
    #WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    #OUTPUT_FILE swigOutput.txt
    #OUTPUT_QUIET)
    
    FIND_PACKAGE(PythonLibs REQUIRED)
    INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_DIRS} ${flowvr_base_SOURCE_DIR}/include ) 
    
    ADD_LIBRARY(cflowvr SHARED cflowvr_wrap.cxx) 
    TARGET_LINK_LIBRARIES(cflowvr ${PYTHON_LIBRARIES} flowvr-base flowvr-mod) # ${FLOWVR_base_LIBRARY}  ${FLOWVR_mod_LIBRARY})  
    set_target_properties(cflowvr PROPERTIES OUTPUT_NAME "_cflowvr" PREFIX "") #INSTALL_NAME_DIR "${CMAKE_INSTALL_PREFIX}/lib/flowvr/python") 
    INSTALL(TARGETS cflowvr DESTINATION ${CMAKE_INSTALL_PREFIX}/lib/flowvr/python)


    
    INSTALL(FILES flowvr.py cflowvr.py spy_module.py DESTINATION ${CMAKE_INSTALL_PREFIX}/lib/flowvr/python)

  ELSE( PYTHONLIBS_FOUND  AND SWIG_FOUND  )
    
    # Disable  Option if missing dependencies
    SET(BUILD_FLOWVR_PYTHONMODULEAPI FALSE CACHE BOOL "Build FlowVR Python Module API" FORCE)
    MESSAGE( "FlowVR Python Module API : SWIG or PythonLibs are missing. BUILD_FLOWVR_PYTHONMODULEAPI option turned OFF")

  ENDIF( PYTHONLIBS_FOUND  AND SWIG_FOUND  )

ENDIF( BUILD_FLOWVR_PYTHONMODULEAPI ) 

# Feature logged once all dependencies have been checked.
MACRO_LOG_FEATURE(BUILD_FLOWVR_PYTHONMODULEAPI "FlowVR Python Module API (flowvr-moduleapi/python)" "FlowVR Module API to support Python modules" "http://flowvr.sf.net" FALSE "Optional")
MACRO_DISPLAY_FEATURE_LOG()
